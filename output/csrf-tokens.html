
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="HandheldFriendly" content="True" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="robots" content="" />

  <link href="https://fonts.googleapis.com/css?family=Source+Code+Pro|Source+Sans+Pro:300,400,400i,700" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="/theme/stylesheet/style.min.css">

  <link rel="stylesheet" type="text/css" href="/theme/pygments/github.min.css">
  <link rel="stylesheet" type="text/css" href="/theme/font-awesome/css/font-awesome.min.css">







<meta name="author" content="jinhaochan" />
<meta name="description" content="If we look at source codes of HTML forms, we typically can spot this field being rendered on the webpage ![placeholder]({attach}media/2019/04/token.png){.wp-image-420} Sometimes it doesn&#39;t have the name called CSRF Token, and it just appears as a random gibberish value being loaded. This post …" />
<meta name="keywords" content="CSRF">

<meta property="og:site_name" content="glob"/>
<meta property="og:title" content="CSRF Tokens"/>
<meta property="og:description" content="If we look at source codes of HTML forms, we typically can spot this field being rendered on the webpage ![placeholder]({attach}media/2019/04/token.png){.wp-image-420} Sometimes it doesn&#39;t have the name called CSRF Token, and it just appears as a random gibberish value being loaded. This post …"/>
<meta property="og:locale" content="en_US"/>
<meta property="og:url" content="/csrf-tokens.html"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2019-04-24 16:13:00+08:00"/>
<meta property="article:modified_time" content=""/>
<meta property="article:author" content="/author/jinhaochan.html">
<meta property="article:section" content="Security"/>
<meta property="article:tag" content="CSRF"/>
<meta property="og:image" content="">

  <title>glob &ndash; CSRF Tokens</title>

</head>
<body>
  <aside>
    <div>
      <a href="">
        <img src="/theme/img/profile.png" alt="" title="">
      </a>
      <h1><a href=""></a></h1>


      <nav>
        <ul class="list">

          <li><a href="/">All</a></li>
          <li><a href="/category/data-science.html">Data Science</a></li>
          <li><a href="/category/security.html">Cyber Security</a></li>
          <li><a href="/category/software-engineering.html">Software Engineering</a></li>
          <li><a href="/category/review.html">Book Reviews</a></li>
          <li><a href="/category/ramblings.html">Ramblings</a></li>
        </ul>
      </nav>

      <ul class="social">
        <li><a class="sc-linkedin" href="https://www.linkedin.com/in/jinhao-hao-chan-162630120/" target="_blank"><i class="fa fa-linkedin"></i></a></li>
        <li><a class="sc-github" href="https://www.github.com/jinhaochan" target="_blank"><i class="fa fa-github"></i></a></li>
      </ul>
    </div>


  </aside>
  <main>


<article class="single">
  <header>
      
    <h1 id="csrf-tokens">CSRF Tokens</h1>
    <p>
          Posted on Wed 24 April 2019 in <a href="/category/security.html">Security</a>


    </p>
  </header>


  <div>
    <!-- wp:paragraph -->

<p>If we look at source codes of HTML forms, we typically can spot this field being rendered on the webpage</p>
<!-- /wp:paragraph -->

<!-- wp:image {"id":420} -->

<figure class="wp-block-image">
![placeholder]({attach}media/2019/04/token.png){.wp-image-420}

<figcaption>


</figcaption>

<!-- /wp:image -->

<!-- wp:paragraph -->

Sometimes it doesn't have the name called CSRF Token, and it just appears as a random gibberish value being loaded.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

This post breaks down the purpose of the token, and what happens behind the scenes with the token

<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->

### Understanding CSRF  

<!-- /wp:heading -->

<!-- wp:separator -->

------------------------------------------------------------------------

<!-- /wp:separator -->

</p>
<!-- wp:paragraph -->

CSRF stands for Cross-Site Request Forgery, and understanding how it works is a prerequisite to understanding CSRF tokens. Below shows a picture of what a CSRF attack looks like

<!-- /wp:paragraph -->

<!-- wp:image {"id":421} -->

<figure class="wp-block-image">
![placeholder]({attach}media/2019/04/csrf-cross-site-request-forgery.png){.wp-image-421}


<!-- /wp:image -->

<!-- wp:list {"ordered":true} -->

1.  The attacker crafts a GET requests that triggers a fund transfer to his account
    -   `GET http://bank.com/transfer.php?account=Attacker&amount=100`
2.  The attacker embeds this request as a hyperlink
    -   `<a href="http://bank.com transfer.php?account=Attacker&amount=100"> READ MORE... </a>`</code>
3.  When the user clicks on the link, it triggers the `GET` request on behalf of the victim
4.  The `GET` request is triggered by the victim, and funds are transferred to the Attacker

<!-- /wp:list -->

<!-- wp:paragraph -->

This attack hinges on the fact that the Victim must be logged in to the service, and is already authenticated with an open session with the service.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

If the Victim is not logged in, when he clicks on the malicious link, instead of triggering the bad `GET` request, it will redirect him to the login page instead, thus rendering the attack useless.

<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->

### CSRF Tokens

<!-- /wp:heading -->

<!-- wp:separator -->

------------------------------------------------------------------------

<!-- /wp:separator -->

</p>
<!-- wp:paragraph -->

CSRF token is a simple concept where include one more argument of a token, that is sort of like a secret password.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

`http://bank.com/transfer.php?account=User&amount=100&token=32Sa2dsa10gB88vcx9cz08f331j=Da`

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

This token value is a high-entropy value which is hard to guess by the attacker. If on the server side, it receives a wrong or missing CSRF token value, the `GET` request is rejected and does not execute

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

The CSRF token works this way:

<!-- /wp:paragraph -->

<!-- wp:list {"ordered":true} -->

1.  Client requests for a HTML page that contains a form
2.  Server generates two distinct tokens, and sends one as a cookie to the client, and embeds the other as a hidden field in the form
3.  When the client submits the form, both CSRF tokens must be sent back to the server. The one embedded in the form, and the one in the cookie.
4.  If the request does not contain both tokens, it's rejected

<!-- /wp:list -->

<!-- wp:paragraph -->

The CSRF token value should be regularly invalidated at a time interval, per request, or when the user logs out.

<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->

### CSRF Token Vulnerabilities

<!-- /wp:heading -->

<!-- wp:separator -->

------------------------------------------------------------------------

<!-- /wp:separator -->

</p>
<!-- wp:paragraph -->

If traffic carrying the token is not encrypted over HTTPS, the Attacker can sniff the traffic and obtain the CSRF token value and the Cookie, and perform a CSRF token replay attack.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

The solution to this is obvious: Always use encryption for communication. Aside from that, per-request-tokens can also be implemented.

<!-- /wp:paragraph -->
  </div>
  <div class="tag-cloud">
    <p>
      <a href="/tag/csrf.html">CSRF</a>
    </p>
  </div>





</article>

    <footer>
<p>&copy;  </p>
<p>    Powered by <a href="http://getpelican.com" target="_blank">Pelican</a> - <a href="https://github.com/alexandrevicenzi/flex" target="_blank">Flex</a> theme by <a href="http://alexandrevicenzi.com" target="_blank">Alexandre Vicenzi</a>
</p>    </footer>
  </main>




<script type="application/ld+json">
{
  "@context" : "http://schema.org",
  "@type" : "Blog",
  "name": " glob ",
  "url" : "",
  "image": "",
  "description": ""
}
</script>

</body>
</html>
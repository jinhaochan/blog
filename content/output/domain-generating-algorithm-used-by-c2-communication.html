<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Domain Generating Algorithm (Used by C2 Communication)</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="A Pelican Blog Atom Feed" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">A Pelican Blog </a></h1>
                <nav><ul>
                    <li><a href="/category/book-review.html">Book Review</a></li>
                    <li><a href="/category/data-science.html">Data Science</a></li>
                    <li><a href="/category/misc.html">misc</a></li>
                    <li><a href="/category/ramblings.html">Ramblings</a></li>
                    <li><a href="/category/review.html">Review</a></li>
                    <li class="active"><a href="/category/security.html">Security</a></li>
                    <li><a href="/category/software-engineering.html">Software Engineering</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/domain-generating-algorithm-used-by-c2-communication.html" rel="bookmark"
           title="Permalink to Domain Generating Algorithm (Used by C2 Communication)">Domain Generating Algorithm (Used by C2 Communication)</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2019-04-07T16:46:00+00:00">
                Published: Sun 07 April 2019
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/jinhaochan.html">jinhaochan</a>
        </address>
<p>In <a href="/category/security.html">Security</a>.</p>
<p>tags: <a href="/tag/domain-generation-algorithm.html">Domain Generation Algorithm</a> </p>
</footer><!-- /.post-info -->      <!-- wp:heading {"level":3} -->

<h3>C2 Communication and Disruption</h3>
<hr>
<p>When a machine gets infected by a malware, it can start receiving command from it's C2 server to perform unwanted activities. Examples of this are a machines infected with botnets or ransomware, where the C2 server will send commands down to the victim machine, and the machines can send replies back.</p>
<p>The easiest way to tackle this problem is to disrupt the communication between the C2 and the victim machine, and one of this is to either take down the C2 server, or block all traffic that is going to that specific IP address.</p>
<!-- wp:heading {"level":3} -->

<h3>How Malwares Overcome Communication Disruption</h3>
<hr>
<p>Bad actors are well aware of this problem of having a single static IP or server for their C2, and they know that if this single IP is block or the server is taken down, their infected machines have no where to receive commands from.</p>
<p>How they overcome this is by having their malware communicate with different domains instead of a single static one. This act is called <strong>"Domain Fluxing</strong>", or <strong>"Fast Fluxing"</strong>, where the malware communicates with different C2 servers.</p>
<p>The process of generating multiple domains for their malware to connect to is called <strong>"Domain Generation Algorithm" (DGA)</strong>.</p>
<!-- wp:heading {"level":3} -->

<h3>DGA in Action</h3>
<hr>
<p>DGAs automatically generate multiple domains that the malware can communicate to. These DGA's have to be random enough, so that defenders cannot predict what list of domains to block. For example, if a malware is dumb enough to change their list of domains to "badserver1", "badserver2" ... Defenders just have to block "badserver*", and that will cover all the list of C2 servers.</p>
<p>Dumb DGAs will also generate jibberish domains, which can be spotted easily by analyst, or smart NLP models. Domains such as "dsawkkl.com" generated randomly is obviously a malicious domain.</p>
<p>Smarter DGAs will pluck and piece together words that make sense, such as "Birds.com", "Elephant.com" or "Tiger.com". But this also has a downside, as its obvious that their seed for generating the names are animals. Really advanced DGAs will use and NLP text generator model, and a random seed generator to produce really legitimate looking domains that can fool both the analyst, and models.</p>
<p>Below is an example code to generate random domains</p>
<!-- wp:code -->

<div class="highlight"><pre><span></span><span class="nv">def</span> <span class="nv">generate_domain</span><span class="ss">(</span><span class="nv">year</span>, <span class="nv">month</span>, <span class="nv">day</span><span class="ss">)</span>:
    <span class="s2">&quot;&quot;&quot;</span><span class="s">Generates a domain name for the given date.</span><span class="s2">&quot;&quot;&quot;</span>

    <span class="nv">domain</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">for</span> <span class="nv">i</span> <span class="nv">in</span> <span class="nv">range</span><span class="ss">(</span><span class="mi">16</span><span class="ss">)</span>:
        <span class="nv">year</span> <span class="o">=</span> <span class="ss">((</span><span class="nv">year</span> <span class="o">^</span> <span class="mi">8</span> <span class="o">*</span> <span class="nv">year</span><span class="ss">)</span> <span class="o">&gt;&gt;</span> <span class="mi">11</span><span class="ss">)</span> <span class="o">^</span> <span class="ss">((</span><span class="nv">year</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="nv">xFFFFFFF0</span><span class="ss">)</span> <span class="o">&lt;&lt;</span> <span class="mi">17</span><span class="ss">)</span>
        <span class="nv">month</span> <span class="o">=</span> <span class="ss">((</span><span class="nv">month</span> <span class="o">^</span> <span class="mi">4</span> <span class="o">*</span> <span class="nv">month</span><span class="ss">)</span> <span class="o">&gt;&gt;</span> <span class="mi">25</span><span class="ss">)</span> <span class="o">^</span> <span class="mi">16</span> <span class="o">*</span> <span class="ss">(</span><span class="nv">month</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="nv">xFFFFFFF8</span><span class="ss">)</span>
        <span class="nv">day</span> <span class="o">=</span> <span class="ss">((</span><span class="nv">day</span> <span class="o">^</span> <span class="ss">(</span><span class="nv">day</span> <span class="o">&lt;&lt;</span> <span class="mi">13</span><span class="ss">))</span> <span class="o">&gt;&gt;</span> <span class="mi">19</span><span class="ss">)</span> <span class="o">^</span> <span class="ss">((</span><span class="nv">day</span> <span class="o">&amp;</span> <span class="mi">0</span><span class="nv">xFFFFFFFE</span><span class="ss">)</span> <span class="o">&lt;&lt;</span> <span class="mi">12</span><span class="ss">)</span>

    <span class="nv">domain</span> <span class="o">+=</span> <span class="nv">chr</span><span class="ss">(((</span><span class="nv">year</span> <span class="o">^</span> <span class="nv">month</span> <span class="o">^</span> <span class="nv">day</span><span class="ss">)</span> <span class="o">%</span> <span class="mi">25</span><span class="ss">)</span> <span class="o">+</span> <span class="mi">97</span><span class="ss">)</span>
</pre></div>


<!-- /wp:code -->

<!-- wp:heading {"level":3} -->

<h3>Conclusion</h3>
<hr>
<p>Malwares need to communicate with C2's for commands. It's easy to block a single domain, or list of correlated domains.</p>
<p>Malwares therefore need sophisticated DGAs to come up with unpredictable domains for their C2 server.</p>
    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>